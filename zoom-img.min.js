!function(e){e.fn.dragmove=function(){return this.each(function(){var o,i,t,a=e(document),n=e(this);n.on("mousedown touchstart",function(e){return o=!0,i=e.originalEvent.pageX-n.offset().left,t=e.originalEvent.pageY-n.offset().top,"mousedown"==e.type&&(click=n),"touchstart"==e.type&&(touch=n),null==window.mozInnerScreenX?!1:void 0}),a.on("mousemove touchmove",function(e){"mousemove"==e.type&&o&&click.offset({left:e.originalEvent.pageX-i,top:e.originalEvent.pageY-t}),"touchmove"==e.type&&o&&touch.offset({left:e.originalEvent.pageX-i,top:e.originalEvent.pageY-t})}).on("mouseup touchend",function(){o=!1})})},e.fn.zoomImg=function(o){var i={color:"#000",opacity:.5,loading:"img/loading100.gif"},t=e.extend(i,o),a=e(this),n=[],r=0,l=.5;e("#gallery").children();a.each(function(o){n.push(e(this).attr("data"))}),function(){var o="background:"+t.color+";opacity:"+t.opacity,i='<div id="zoomLayer" class="zoom100" style="display:none;"><img id="zoomImg" class="loading" src="'+t.loading+'" /></div>';i+='<div id="popPreview" style="display:none;"><div class="alpha_bg" style="'+o+'"></div><div id="preview"></div><div class="popFooter">',i+='<div class="nav"><ul><li><a class="left" href="javascript:void(0)">上一个</a></li>',i+='<li><a class="right" href="javascript:void(0)">下一个</a></li><li><a class="enlarge" href="javascript:void(0)"></a></li>',i+='<li><a class="narrow" href="javascript:void(0)"></a></li><li><a class="close" href="javascript:void(0)">X</a></li></ul>',i+='</div></div><a href="javascript:void(0);" id="popPreviewTools" class="pop_close">关闭</a></div>',e(document.body).append(i);var a="<style id=dynamic></style>";e(document.head).append(a),e("<link>").attr({rel:"stylesheet",type:"text/css",href:"./zoom.min.css"}).appendTo("head")}();var s=function(o,i){e("#zoomLayer").show();var t=new Image;return t.src=o,t.complete?(e("#zoomLayer").hide(),i.call(t),!1):void(t.onload=function(){e("#zoomLayer").hide(),i.call(t)})},c=function(o,i,t){var a=0,n=(Math.round(i/2),Math.round(t/2),e(window).width()),r=e(window).height();if(640>=n){l=n/i;var s=t*l;a=(r-s)/2+"px",left=0;var c='<img class="reviewphoto move" style="top:'+a+";left:"+left+";width:"+n+'px;" src="'+o+'">'}else{i>=n?t>=r?(l=Math.ceil(n*r/(i*t)*100)/100,a="-"+(t-r)/2+"px",left=(n-i)/2+"px"):(l=Math.ceil(n/i*100)/100,a=(r-t)/2+"px",left="-"+(i-n)/2+"px"):t>i&&t>=r?(l=Math.ceil(r/t*100)/100,a="-"+(t-r)/2+"px",left=(n-i)/2+"px"):(l=1,a=(r-t)/2+"px",left=(n-i)/2+"px");var v=document.getElementById("dynamic");v.innerHTML="@-webkit-keyframes mymove {0%{-webkit-transform:scale(0);}100%{-webkit-transform:scale("+l+");}}@keyframes mymove {0%{transform:scale(0);}100%{transform:scale("+l+");}}";var c='<img class="reviewphoto move" style="top:'+a+";left:"+left+';" src="'+o+'">'}return c},v=function(o){o=o||window.event;var i,t=e("#popPreview").css("display"),a=e("#preview .reviewphoto");"block"==t&&(o.wheelDelta?(o.wheelDelta>0&&(l=parseFloat(l+.1)),o.wheelDelta<0&&(l=parseFloat((l-.1).toFixed(1)),l=0>l?0:l)):o.detail&&(o.detail>0&&(l+=.05),o.detail<0&&(l=0>=l?0:l-=.1)),e("#preview .reviewphoto").removeClass("move"),i="scale("+l+")",a.css("-webkit-transform",i))},p=function(o){e("#preview").html(o),e("#popPreview").show(),e("#preview .reviewphoto").dragmove()};a.on("click",function(){var o=e(this).attr("data");return void 0==o?!1:(r=a.index(e(this)),void s(o,function(){p(c(o,this.width,this.height)),e("#popPreview .close,#popPreviewTools").click(function(){e("#popPreview").hide()}),e("#popPreview .enlarge").click(function(){l=parseFloat(l+.1);var o="scale("+l+")";e("#preview .reviewphoto").removeClass("move"),e("#preview .reviewphoto").css("-webkit-transform",o)}),e("#popPreview .narrow").click(function(){l=parseFloat((l-.1).toFixed(1)),l=0>l?0:l;var o="scale("+l+")";e("#preview .reviewphoto").removeClass("move"),e("#preview .reviewphoto").css("-webkit-transform",o)}),e("#popPreview .left").click(function(){0==r?r=n.length-1:r-=1,s(n[r],function(){p(c(n[r],this.width,this.height))})}),e("#popPreview .right").click(function(){r+1==n.length?r=0:r+=1,s(n[r],function(){p(c(n[r],this.width,this.height))})})}))}),document.addEventListener&&document.addEventListener("DOMMouseScroll",v,!1),document.onmousewheel=v,document.onkeydown=function(o){var i=o||window.event||arguments.callee.caller.arguments[0];i&&27==i.keyCode&&e("#popPreview").hide()}}}(jQuery);